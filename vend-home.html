<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Painel do Vendedor ‚Ä¢ TaNaFeira</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

<style>
:root{
  --green:#3aa86b;
  --green-dark:#1e5c3a;
  --bg:#f4faf7;
  --card:#ffffff;
  --muted:#6b8f86;
  --shadow:0 14px 30px rgba(0,0,0,.08);
}

*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,system-ui}
body{background:var(--bg);color:#10312c}

/* ===== HEADER ===== */
header{
  position:fixed;top:0;left:0;right:0;
  height:78px;
  background:#fff;
  border-bottom:1px solid rgba(0,0,0,.08);
  z-index:1000;
}
.header{
  max-width:1300px;
  margin:0 auto;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
}
.brand{display:flex;align-items:center;gap:14px}
.brand img{height:36px}
.profileTop{
  display:flex;
  align-items:center;
  gap:12px;
  cursor:pointer;
}
.profileTop img{
  width:44px;height:44px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid var(--green);
}
.profileTop div{line-height:1.1}
.profileTop b{font-size:14px}
.profileTop span{font-size:12px;color:var(--muted)}

/* ===== LAYOUT ===== */
.wrapper{
  max-width:1300px;
  margin:0 auto;
  display:grid;
  grid-template-columns:240px 1fr;
  gap:24px;
  padding:110px 20px 40px;
}

/* ===== MENU ===== */
nav{
  background:#fff;
  border-radius:18px;
  box-shadow:var(--shadow);
  padding:16px;
  height:fit-content;
}
nav a{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  border-radius:12px;
  font-weight:600;
  color:#10312c;
  text-decoration:none;
  transition:.15s;
}
nav a i{color:var(--green)}
nav a:hover{background:#eef7f2}
nav a.active{background:#e6f6ee;font-weight:700}

/* ===== MAIN ===== */
main h1{
  font-size:26px;
  margin-bottom:6px;
}
main p{color:var(--muted);margin-bottom:18px}

/* ===== FEED ===== */
.feed{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:18px;
}
.card{
  background:var(--card);
  border-radius:18px;
  box-shadow:var(--shadow);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.card img{
  width:100%;
  height:160px;
  object-fit:cover;
}
.card .body{
  padding:14px;
  flex:1;
}
.card h3{font-size:15px}
.price{font-weight:700;color:var(--green)}
.card .actions{
  padding:12px;
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.btn{
  flex:1;
  border:none;
  border-radius:10px;
  padding:10px;
  font-weight:700;
  cursor:pointer;
}
.edit{background:#e9f7f0;color:#1e5c3a}
.pause{background:#f1f1f1}

/* ===== EMPTY ===== */
.empty{
  background:#fff;
  border-radius:18px;
  padding:40px;
  text-align:center;
  box-shadow:var(--shadow);
}
.empty i{
  font-size:48px;
  color:var(--green);
  margin-bottom:14px;
}
.empty b{font-size:18px}
.empty p{margin-top:6px}

/* ===== RESPONSIVE ===== */
@media(max-width:900px){
  .wrapper{grid-template-columns:1fr}
  nav{display:flex;gap:10px;overflow-x:auto}
  nav a{white-space:nowrap}
}
</style>
</head>

<body>

<header>
  <div class="header">
    <div class="brand">
      <img src="LogoTaNaFeira.png">
    </div>

    <!-- üëâ CLIQUE AQUI VAI PRO PERFIL -->
    <div class="profileTop" id="goProfile">
      <img id="avatarTop">
      <div>
        <b id="storeName">Minha banca</b><br>
        <span>Ver perfil</span>
      </div>
    </div>
  </div>
</header>

<div class="wrapper">

  <!-- MENU -->
  <nav>
    <a class="active"><i class="fa-solid fa-house"></i> Home</a>
    <a href="vend-produtos.html"><i class="fa-solid fa-box"></i> Produtos</a>
    <a href="vend-reservas.html"><i class="fa-solid fa-receipt"></i> Reservas</a>
    <a href="vend-perfil.html"><i class="fa-solid fa-user"></i> Perfil</a>
    <a id="logout"><i class="fa-solid fa-right-from-bracket"></i> Sair</a>
  </nav>

  <!-- MAIN -->
  <main>
    <h1>Seus produtos</h1>
    <p>Gerencie seus produtos e acompanhe suas vendas.</p>

    <div id="feed" class="feed"></div>

    <div id="empty" class="empty" style="display:none">
      <i class="fa-solid fa-box-open"></i>
      <b>Nenhum produto cadastrado</b>
      <p>Cadastre seu primeiro produto para come√ßar a vender.</p>
    </div>
  </main>

</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const sb = supabase.createClient(
 "https://addedjckqdzwgdstgqfz.supabase.co",
 "sb_publishable_WaH0GklqXIWCYjL2jVzZjg_GD6XdrXB"
);

const feed = document.getElementById("feed");
const empty = document.getElementById("empty");

async function loadVendor(){
 const { data:{ user }} = await sb.auth.getUser();
 if(!user){ location.href="login.html"; return }

 const { data:profile } = await sb
  .from("profiles")
  .select("store_name,avatar_url")
  .eq("id",user.id)
  .single();

 document.getElementById("storeName").textContent =
   profile.store_name || "Minha banca";

 document.getElementById("avatarTop").src =
   profile.avatar_url || "https://via.placeholder.com/100";

 document.getElementById("goProfile").onclick =
   ()=>location.href="vend-perfil.html";

 loadProducts(user.id);
}

async function loadProducts(vendorId){
 const { data:products } = await sb
  .from("products")
  .select("id,name,price,image_url")
  .eq("vendor_id",vendorId);

 if(!products || products.length===0){
   empty.style.display="block";
   return;
 }

 feed.innerHTML="";
 products.forEach(p=>{
   feed.innerHTML+=`
    <div class="card">
      <img src="${p.image_url || 'https://via.placeholder.com/300'}">
      <div class="body">
        <h3>${p.name}</h3>
        <div class="price">R$ ${p.price}</div>
      </div>
      <div class="actions">
        <button class="btn edit">Editar</button>
        <button class="btn pause">Pausar</button>
      </div>
    </div>
   `;
 });
}

document.getElementById("logout").onclick = async ()=>{
 await sb.auth.signOut();
 location.href="login.html";
};

loadVendor();
</script>

</body>
</html>
