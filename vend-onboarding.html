<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TaNaFeira ‚Ä¢ Onboarding do Vendedor</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

<style>
:root{
  --verde:#3aa86b;
  --bg:#f5fbf8;
  --text:#0f2f2b;
  --muted:rgba(16,49,44,.72);
  --surface:rgba(255,255,255,.96);
  --shadow:0 14px 36px rgba(0,0,0,.12);
  --radius:22px;
  --header-h:78px;
}

/* reset */
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,system-ui,Arial;}
body{
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
}

/* ===== HEADER ===== */
header{
  position:fixed;
  top:0;left:0;right:0;
  height:var(--header-h);
  background:rgba(255,255,255,.9);
  backdrop-filter:blur(10px);
  border-bottom:1px solid rgba(0,0,0,.08);
  z-index:999;
}
.header-inner{
  max-width:980px;
  height:100%;
  margin:auto;
  padding:0 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.brand{
  display:flex;
  align-items:center;
  gap:12px;
}
.brand img{height:36px}
.hello{font-weight:1000;font-size:14px}

/* ===== MAIN ===== */
main{
  max-width:980px;
  margin:auto;
  padding:calc(var(--header-h) + 40px) 20px 40px;
}

h1{
  font-size:28px;
  margin-bottom:6px;
}
p.lead{
  color:var(--muted);
  font-weight:800;
  margin-bottom:20px;
}

/* ===== CARD ===== */
.card{
  background:var(--surface);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:20px;
  display:grid;
  gap:18px;
}

.section h2{
  font-size:16px;
  font-weight:1000;
}
.hint{
  font-size:13px;
  color:var(--muted);
  font-weight:800;
  margin-top:4px;
}

/* ===== INPUTS ===== */
input[type=text], textarea{
  width:100%;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(0,0,0,.15);
  font-size:15px;
  font-weight:800;
}
textarea{min-height:120px;resize:vertical}

/* ===== CATEGORIES ===== */
.cats{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:10px;
  margin-top:10px;
}
.cat{
  border:1px solid rgba(0,0,0,.12);
  border-radius:14px;
  padding:12px;
  display:flex;
  gap:10px;
  align-items:flex-start;
  cursor:pointer;
}
.cat input{accent-color:var(--verde)}
.cat strong{font-size:14px}

/* ===== UPLOAD ===== */
.media{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
}
.preview{
  background:#f2f5f4;
  border:1px dashed rgba(0,0,0,.2);
  border-radius:14px;
  height:140px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:13px;
  color:var(--muted);
}
.preview img{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:14px;
}

/* ===== ERRORS ===== */
.field-error{
  font-size:12.6px;
  font-weight:900;
  color:#c0392b;
  margin-top:6px;
  display:none;
}
.field-error.show{display:block}

/* ===== ACTION ===== */
.actions{
  display:flex;
  justify-content:flex-end;
  margin-top:10px;
}
button{
  border:none;
  background:var(--verde);
  color:#fff;
  font-weight:1000;
  padding:14px 22px;
  border-radius:999px;
  cursor:pointer;
}
button:disabled{opacity:.6}
</style>
</head>

<body>

<header>
  <div class="header-inner">
    <div class="brand">
      <img src="LogoTaNaFeira.png">
      <div class="hello" id="hello">Ol√°!</div>
    </div>
    <button id="logout">Sair</button>
  </div>
</header>

<main>
  <h1>Complete seu perfil</h1>
  <p class="lead">Categorias e bio s√£o obrigat√≥rias. Fotos ajudam compradores a te reconhecer.</p>

  <div class="card">

    <!-- STORE NAME -->
    <div>
      <h2>Nome da banca (opcional)</h2>
      <input id="store_name" type="text" maxlength="60" placeholder="Ex: Banca da Dona Maria">
    </div>

    <!-- UPLOAD -->
    <div>
      <h2>Fotos (opcional)</h2>
      <div class="media">
        <div>
          <div class="preview" id="avatarPreview">Avatar</div>
          <input id="avatarFile" type="file" accept="image/*">
        </div>
        <div>
          <div class="preview" id="headerPreview">Header</div>
          <input id="headerFile" type="file" accept="image/*">
        </div>
      </div>
      <div id="err-media" class="field-error"></div>
    </div>

    <!-- CATEGORIES -->
    <div>
      <h2>Categorias *</h2>
      <div class="cats" id="cats"></div>
      <div id="err-categories" class="field-error"></div>
    </div>

    <!-- BIO -->
    <div>
      <h2>Sua bio *</h2>
      <textarea id="bio" maxlength="300"></textarea>
      <div id="err-bio" class="field-error"></div>
    </div>

    <div class="actions">
      <button id="save">Concluir</button>
    </div>

  </div>
</main>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
/* ===== CONFIG ===== */
const BUCKET_VENDOR_MEDIA = "vendor-media"; // üî• COLOQUE SEU BUCKET AQUI
const SUPABASE_URL = "https://addedjckqdzwgdstgqfz.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_WaH0GklqXIWCYjL2jVzZjg_GD6XdrXB";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ===== HELPERS ===== */
const qs = id=>document.getElementById(id);
function setErr(id,msg){ const e=qs(id); e.textContent=msg; e.classList.add("show"); }
function clearErr(id){ const e=qs(id); e.textContent=""; e.classList.remove("show"); }
function clearAll(){["err-media","err-categories","err-bio"].forEach(clearErr);}

/* ===== LOAD USER ===== */
async function requireVendor(){
  const { data:{user} } = await sb.auth.getUser();
  if(!user){location.href="login.html";return;}
  qs("hello").textContent = "Ol√°, " + (user.email.split("@")[0]) + "!";
}
requireVendor();

/* ===== LOAD CATEGORIES ===== */
async function loadCategories(){
  const { data } = await sb.from("categories").select("id,name");
  qs("cats").innerHTML = data.map(c=>`
    <label class="cat">
      <input type="checkbox" value="${c.id}">
      <strong>${c.name}</strong>
    </label>`).join("");
}
loadCategories();

/* ===== PREVIEW ===== */
function preview(input,box){
  input.onchange=()=> {
    const f=input.files[0];
    if(!f) return;
    const url=URL.createObjectURL(f);
    box.innerHTML=`<img src="${url}">`;
  }
}
preview(qs("avatarFile"),qs("avatarPreview"));
preview(qs("headerFile"),qs("headerPreview"));

/* ===== SAVE ===== */
qs("save").onclick = async ()=>{
  clearAll();

  const cats=[...document.querySelectorAll("#cats input:checked")].map(i=>i.value);
  const bio=qs("bio").value.trim();

  let hasErr=false;
  if(cats.length===0){setErr("err-categories","Selecione ao menos uma categoria.");hasErr=true;}
  if(bio.length<10){setErr("err-bio","A bio deve ter no m√≠nimo 10 caracteres.");hasErr=true;}
  if(hasErr) return;

  await sb.from("profiles").update({
    vendor_onboarding_done:true,
    bio,
    store_name:qs("store_name").value||null
  }).eq("id",(await sb.auth.getUser()).data.user.id);

  location.href="vend-home.html";
};

/* ===== LOGOUT ===== */
qs("logout").onclick=async()=>{await sb.auth.signOut();location.href="login.html";}
</script>

</body>
</html>
